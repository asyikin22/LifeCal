<!DOCTYPE html>
<html>
<head>
  <title>Life Calendar Grid with Flags</title>
  <link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css" rel="stylesheet">
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
      padding: 20px;
      box-sizing: border-box;
    }
    .top-bar {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      width: 100%;
    }
    .box {
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      width: 200px;
      text-align: center;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }
    .box h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 30px;
    }
    .box input, .box button, .box select {
      width: 100%;
      padding: 6px;
      margin: 4px 0;
      text-align: center;
      font-size: 12px;
      box-sizing: border-box;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 8px;
      justify-content: center;
      width: 100%;
      max-width: 1000px;
      box-sizing: border-box;
    }
    .grid-item {
      min-width: 90px;
      min-height: 130px;
      border: 1px solid #999;
      text-align: center;
      font-size: 10px;
      padding: 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #fff;
      box-sizing: border-box;
      overflow: hidden;
    }
    .grid-item select {
        width: 100%;
        font-size: 10px;
        padding: 2px 4px;
        box-sizing: border-box;
    }
    .grid-item .ts-wrapper {
        width: 100% !important;
        font-size: 10px;
        box-sizing: border-box;
        overflow: hidden;
    }
    .grid-item .ts-control {
        height: auto !important;
        padding: 2px 4px !important;
        font-size: 10px;
    }
    .grid-item .ts-dropdown {
        width: 100% !important;
        max-height: 100px;
        overflow-y: auto;
        font-size: 10px;
        box-sizing: border-box;
    }
    .age-year-container {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 4px;
    }
    .age {
      font-weight: bold;
    }
    .year {
      font-size: 10px;
      color: #555;
    }
    .flag-icon {
      width: 16px;
      height: 12px;
      vertical-align: middle;
      display: none;
    }
    .event-block {
      margin-top: 4px;
      width: 100%;
      text-align: center;
      padding: 2px;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 10px;
    }
    .event-block input {
      width: 90%;
      font-size: 10px;
      margin-top: 2px;
      box-sizing: border-box;
    }
    .add-event-btn {
      font-size: 10px;
      margin-top: 4px;
      padding: 2px 4px;
      cursor: pointer;
    }
    .education { background-color: #f9c5d1; }
    .work { background-color: #d1e0ff; }
    .travel { background-color: #b2f2bb; }
    .wedding { background-color: #fbc2eb; }
    .loss { background-color: #d3d3d3; }
    .other { background-color: #fce38a; }
  </style>
</head>
<body>

<div class="top-bar">
  <div class="box">
    <h3>My Life Calendar</h3>
    <div id="ageDisplay" style="margin-top: 10px; font-size: 12px;"></div>
  </div>
  <div class="box">
    <label>Birth Year:</label>
    <input type="number" id="birthYearInput" placeholder="e.g. 1990">
    <button onclick="generateGrid()">Generate Calendar</button>
  </div>
  <div class="box">
    <label>Country/Timezone:</label>
    <select id="timezoneSelect">
      <option value="Asia/Kuala_Lumpur">Malaysia</option>
      <option value="America/New_York">United States (New York)</option>
      <option value="Europe/London">United Kingdom</option>
      <option value="Australia/Sydney">Australia (Sydney)</option>
      <option value="America/Toronto">Canada (Toronto)</option>
      <option value="Europe/Berlin">Germany</option>
      <option value="Asia/Tokyo">Japan</option>
      <option value="Asia/Dubai">United Arab Emirates (Dubai)</option>
      <option value="Europe/Paris">France</option>
      <option value="America/Los_Angeles">United States (Los Angeles)</option>
    </select>
    <div id="dateTime" style="margin-top: 8px; font-size: 12px;"></div>
  </div>
</div>

<div class="grid-container" id="lifeGrid"></div>

<script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
<script>
let selectedTimezone = 'Asia/Kuala_Lumpur';

const countryList = [
  { code: "MY", name: "Malaysia" },
  { code: "US", name: "United States" },
  { code: "GB", name: "United Kingdom" },
  { code: "AU", name: "Australia" },
  { code: "CA", name: "Canada" },
  { code: "DE", name: "Germany" },
  { code: "FR", name: "France" },
  { code: "JP", name: "Japan" },
  { code: "IN", name: "India" },
  { code: "SG", name: "Singapore" }
];

document.getElementById('timezoneSelect').addEventListener('change', function() {
  selectedTimezone = this.value;
});

function updateDateTime() {
  const now = new Date();
  const formatter = new Intl.DateTimeFormat('en-US', {
    timeZone: selectedTimezone,
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });
  document.getElementById('dateTime').innerText = formatter.format(now);
}
setInterval(updateDateTime, 1000);
updateDateTime();

function generateGrid() {
  const grid = document.getElementById('lifeGrid');
  grid.innerHTML = "";

  const birthYear = parseInt(document.getElementById('birthYearInput').value);
  const now = new Date();
  const currentYear = now.getUTCFullYear();

  if (isNaN(birthYear)) {
    alert("Please enter a valid birth year.");
    document.getElementById('ageDisplay').innerText = "";
    return;
  }

  const age = currentYear - birthYear;
  document.getElementById('ageDisplay').innerText = "You are " + age + " years young! üòä";

  for (let ageIndex = 0; ageIndex < 90; ageIndex++) {
    const div = document.createElement('div');
    div.className = 'grid-item';

    const ageYearContainer = document.createElement('div');
    ageYearContainer.className = 'age-year-container';

    const ageDiv = document.createElement('div');
    ageDiv.className = 'age';
    ageDiv.innerText = "Age: " + ageIndex;

    const yearDiv = document.createElement('div');
    yearDiv.className = 'year';
    yearDiv.innerText = birthYear + ageIndex;

    const flagImg = document.createElement('img');
    flagImg.className = 'flag-icon';

    ageYearContainer.appendChild(ageDiv);
    ageYearContainer.appendChild(yearDiv);
    ageYearContainer.appendChild(flagImg);

    const eventsContainer = document.createElement('div');

    const addEventBtn = document.createElement('button');
    addEventBtn.innerText = "+";
    addEventBtn.className = 'add-event-btn';
    addEventBtn.title = "Add Event";

    addEventBtn.onclick = function () {
      const emojiSelect = document.createElement('select');
      emojiSelect.innerHTML = `
        <option value="">Select...</option>
        <option value="education">üéì Education</option>
        <option value="work">üíº Work</option>
        <option value="travel">‚úàÔ∏è Travel</option>
        <option value="wedding">üíç Wedding</option>
        <option value="loss">üñ§ Loss</option>
        <option value="other">‚≠ê Other</option>
      `;
      emojiSelect.style.width = "100%";
      emojiSelect.style.fontSize = "10px";
      emojiSelect.style.marginTop = "4px";

      emojiSelect.onchange = function () {
        if (emojiSelect.value) {
          addEvent(emojiSelect.value, eventsContainer);
          emojiSelect.remove();
        }
      };
      eventsContainer.appendChild(emojiSelect);
    };

    eventsContainer.appendChild(addEventBtn);

    const select = document.createElement('select');
    select.innerHTML = '<option value="">-- Select Country --</option>';
    countryList.forEach(country => {
      select.innerHTML += `<option value="${country.code}" data-country="${country.name}">${country.name}</option>`;
    });

    div.appendChild(ageYearContainer);
    div.appendChild(eventsContainer);
    div.appendChild(select);

    grid.appendChild(div);

    const tom = new TomSelect(select, {
      create: false,
      sortField: 'text',
      placeholder: 'Select country...',
      render: {
        item: function(data, escape) {
          return `<img src="https://flagcdn.com/w20/${data.value.toLowerCase()}.png" title="${data.text}" style="vertical-align:middle; width:16px; height:12px;">`;
        },
        option: function(data, escape) {
          return `<div><img src="https://flagcdn.com/w20/${data.value.toLowerCase()}.png" style="vertical-align:middle; width:16px; height:12px; margin-right:4px;">${escape(data.text)}</div>`;
        }
      }
    });

    select.addEventListener('change', function() {
      const selectedOption = select.selectedOptions[0];
      const code = selectedOption.value;
      const country = selectedOption.getAttribute('data-country');

      if (code) {
        flagImg.src = `https://flagcdn.com/w20/${code.toLowerCase()}.png`;
        flagImg.style.display = 'inline-block';
        flagImg.title = country;
        select.parentElement.querySelector('.ts-wrapper').style.display = 'none';
      }
    });
  }
}

function addEvent(eventType, container) {
  const eventBlock = document.createElement('div');
  eventBlock.className = 'event-block ' + eventType;

  const label = document.createElement('div');
  label.innerText = eventType.charAt(0).toUpperCase() + eventType.slice(1);

  const detailInput = document.createElement('input');
  detailInput.type = 'text';
  detailInput.placeholder = 'Details';

  eventBlock.appendChild(label);
  eventBlock.appendChild(detailInput);
  container.appendChild(eventBlock);
}
</script>

</body>
</html>
